openapi: 3.0.0
info:
  title: Sales Order API
  version: 1.0.0

paths:
  /sales-order:
    get:
      summary: Mendapatkan daftar sales order
      tags: [Sales Order]
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Jumlah data per halaman
          schema:
            type: integer
            default: 10
        - name: page
          in: query
          description: Nomor halaman
          schema:
            type: integer
            default: 1
        - name: search
          in: query
          description: Pencarian berdasarkan nomor SO, syarat pembayaran, atau status
          schema:
            type: string
        - name: status
          in: query
          description: Filter berdasarkan status (active, delete_requested, deleted)
          schema:
            type: string
            enum: [active, delete_requested, deleted]
      responses:
        '200':
          description: Berhasil mendapatkan data sales order
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SalesOrder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
    
    post:
      summary: Menambah sales order baru
      tags: [Sales Order]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SalesOrderRequest'
            example:
              nomor_so: "SO-2024-001"
              tanggal_so: "2024-08-17"
              tanggal_pengiriman: "2024-08-20"
              syarat_pembayaran: "Net 30"
              asal_gudang: "Gudang Utama"
              nama_pelanggan: "PT. ABC"
              telepon: "021-12345678"
              email: "contact@abc.com"
              alamat: "Jl. Sudirman No. 123, Jakarta"
              items:
                - panjang: 100.5
                  lebar: 50.2
                  qty: 10
                  jenis_barang: "Kayu"
                  bentuk_barang: "Papan"
                  grade_barang: "A"
                  harga: 150000
                  satuan: "pcs"
                  diskon: 5
                  catatan: "Kualitas premium"
      responses:
        '200':
          description: Berhasil mendapatkan data sales order
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '422':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}:
    get:
      summary: Mendapatkan detail sales order
      tags: [Sales Order]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil mendapatkan data sales order
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    put:
      summary: Mengupdate sales order
      tags: [Sales Order]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SalesOrderRequest'
      responses:
        '200':
          description: Berhasil mendapatkan data sales order
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/soft-delete:
    delete:
      summary: Soft delete sales order (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil melakukan operasi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/restore:
    post:
      summary: Restore sales order yang sudah di-soft delete (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil melakukan operasi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/force-delete:
    delete:
      summary: Permanent delete sales order (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil melakukan operasi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/delete-requests:
    get:
      summary: Mendapatkan daftar sales order yang di request delete (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Jumlah data per halaman
          schema:
            type: integer
            default: 10
        - name: page
          in: query
          description: Nomor halaman
          schema:
            type: integer
            default: 1
        - name: search
          in: query
          description: Pencarian berdasarkan nomor SO atau syarat pembayaran
          schema:
            type: string
        - name: delete_requested_from
          in: query
          description: Filter tanggal request delete dari (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: delete_requested_to
          in: query
          description: Filter tanggal request delete sampai (YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Berhasil mendapatkan data sales order yang di request delete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SalesOrder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /sales-order/pending-delete-requests:
    get:
      summary: Mendapatkan daftar sales order yang pending untuk approval (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: per_page
          in: query
          description: Jumlah data per halaman
          schema:
            type: integer
            default: 10
        - name: page
          in: query
          description: Nomor halaman
          schema:
            type: integer
            default: 1
        - name: search
          in: query
          description: Pencarian berdasarkan nomor SO atau syarat pembayaran
          schema:
            type: string
        - name: delete_requested_from
          in: query
          description: Filter tanggal request delete dari (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: delete_requested_to
          in: query
          description: Filter tanggal request delete sampai (YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Berhasil mendapatkan data sales order yang pending untuk approval
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SalesOrder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /sales-order/{id}/request-delete:
    post:
      summary: Request penghapusan sales order (User)
      tags: [Sales Order]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - delete_reason
              properties:
                delete_reason:
                  type: string
                  description: Alasan penghapusan
                  maxLength: 500
            example:
              delete_reason: "Data tidak valid dan perlu dihapus"
      responses:
        '200':
          description: Berhasil mengirim request penghapusan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '404':
          description: Data tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/approve-delete:
    patch:
      summary: Approve request penghapusan sales order (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil approve request penghapusan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '404':
          description: Request penghapusan tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/reject-delete:
    patch:
      summary: Reject request penghapusan sales order (Admin only)
      tags: [Sales Order - Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rejection_reason
              properties:
                rejection_reason:
                  type: string
                  description: Alasan penolakan
                  maxLength: 500
            example:
              rejection_reason: "Data masih diperlukan untuk referensi"
      responses:
        '200':
          description: Berhasil reject request penghapusan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '404':
          description: Request penghapusan tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validasi gagal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sales-order/{id}/cancel-delete-request:
    patch:
      summary: Cancel request penghapusan sales order (User)
      tags: [Sales Order]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID sales order
      responses:
        '200':
          description: Berhasil cancel request penghapusan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/SalesOrder'
                  message:
                    type: string
        '404':
          description: Request penghapusan tidak ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    SalesOrderRequest:
      type: object
      required:
        - nomor_so
        - tanggal_so
        - tanggal_pengiriman
        - syarat_pembayaran
        - asal_gudang
        - nama_pelanggan
        - telepon
        - email
        - alamat
        - items
      properties:
        nomor_so:
          type: string
          description: Nomor sales order (unique)
        tanggal_so:
          type: string
          format: date
          description: Tanggal sales order
        tanggal_pengiriman:
          type: string
          format: date
          description: Tanggal pengiriman
        syarat_pembayaran:
          type: string
          description: Syarat pembayaran
        asal_gudang:
          type: string
          description: Asal gudang
        nama_pelanggan:
          type: string
          description: Nama pelanggan
        telepon:
          type: string
          description: Nomor telepon
        email:
          type: string
          format: email
          description: Email pelanggan
        alamat:
          type: string
          description: Alamat pelanggan
        items:
          type: array
          minItems: 1
          description: Daftar item sales order
          items:
            $ref: '#/components/schemas/SalesOrderItemRequest'

    SalesOrderItemRequest:
      type: object
      required:
        - panjang
        - lebar
        - qty
        - jenis_barang
        - bentuk_barang
        - grade_barang
        - harga
        - satuan
      properties:
        panjang:
          type: number
          format: float
          minimum: 0
          description: Panjang barang
        lebar:
          type: number
          format: float
          minimum: 0
          description: Lebar barang
        qty:
          type: integer
          minimum: 1
          description: Quantity
        jenis_barang:
          type: string
          description: Jenis barang
        bentuk_barang:
          type: string
          description: Bentuk barang
        grade_barang:
          type: string
          description: Grade barang
        harga:
          type: number
          format: float
          minimum: 0
          description: Harga per unit
        satuan:
          type: string
          description: Satuan
        diskon:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Diskon dalam persen (opsional)
        catatan:
          type: string
          description: Catatan item (opsional)

    SalesOrder:
      type: object
      properties:
        id:
          type: integer
          description: ID sales order
        nomor_so:
          type: string
          description: Nomor sales order
        tanggal_so:
          type: string
          format: date
          description: Tanggal sales order
        tanggal_pengiriman:
          type: string
          format: date
          description: Tanggal pengiriman
        syarat_pembayaran:
          type: string
          description: Syarat pembayaran
        asal_gudang:
          type: string
          description: Asal gudang
        nama_pelanggan:
          type: string
          description: Nama pelanggan
        telepon:
          type: string
          description: Nomor telepon
        email:
          type: string
          description: Email pelanggan
        alamat:
          type: string
          description: Alamat pelanggan
        created_at:
          type: string
          format: date-time
          description: Waktu pembuatan
        updated_at:
          type: string
          format: date-time
          description: Waktu update
        status:
          type: string
          enum: [active, delete_requested, deleted]
          description: Status sales order
        delete_requested_by:
          type: integer
          nullable: true
          description: ID user yang request delete
        delete_requested_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu request delete
        delete_approved_by:
          type: integer
          nullable: true
          description: ID admin yang approve delete
        delete_approved_at:
          type: string
          format: date-time
          nullable: true
          description: Waktu approve delete
        delete_reason:
          type: string
          nullable: true
          description: Alasan penghapusan
        delete_rejection_reason:
          type: string
          nullable: true
          description: Alasan penolakan
        sales_order_items:
          type: array
          items:
            $ref: '#/components/schemas/SalesOrderItem'

    SalesOrderItem:
      type: object
      properties:
        id:
          type: integer
          description: ID sales order item
        sales_order_id:
          type: integer
          description: ID sales order
        panjang:
          type: number
          format: float
          description: Panjang barang
        lebar:
          type: number
          format: float
          description: Lebar barang
        qty:
          type: integer
          description: Quantity
        jenis_barang:
          type: string
          description: Jenis barang
        bentuk_barang:
          type: string
          description: Bentuk barang
        grade_barang:
          type: string
          description: Grade barang
        harga:
          type: number
          format: float
          description: Harga per unit
        satuan:
          type: string
          description: Satuan
        diskon:
          type: number
          format: float
          description: Diskon dalam persen
        catatan:
          type: string
          nullable: true
          description: Catatan item
        created_at:
          type: string
          format: date-time
          description: Waktu pembuatan
        updated_at:
          type: string
          format: date-time
          description: Waktu update

    Pagination:
      type: object
      properties:
        current_page:
          type: integer
        data:
          type: array
        first_page_url:
          type: string
        from:
          type: integer
        last_page:
          type: integer
        last_page_url:
          type: string
        next_page_url:
          type: string
          nullable: true
        path:
          type: string
        per_page:
          type: integer
        prev_page_url:
          type: string
          nullable: true
        to:
          type: integer
        total:
          type: integer

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Validasi gagal"
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string

tags:
  - name: Sales Order
    description: Operasi CRUD untuk sales order
  - name: Sales Order - Admin
    description: Operasi admin untuk sales order